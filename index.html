<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" /> <!-- Zeichencodierung auf UTF-8, Standard für Webseiten -->
  <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- Damit die Seite auf mobilen Geräten richtig skaliert -->
  <title>Scrapetime Streamlit Style</title> <!-- Titel, der im Tab angezeigt wird -->

  <!-- Tailwind CSS wird per CDN eingebunden -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts importieren für schöne Schrift -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    body {
      font-family: 'Inter', sans-serif; /* Schriftart "Inter" auf der ganzen Seite verwenden */
    }
  </style>
</head>
<body
  class="
    flex          /* Body wird flexbox-container: erleichtert vertikale Anordnung */
    flex-col      /* Kinder (Header, Content, Footer) werden vertikal untereinander angeordnet */
    min-h-screen  /* Mindesthöhe: volle Bildschirmhöhe, damit Footer immer unten ist */
    bg-gradient-to-br /* Hintergrund wird als Farbverlauf von oben links (top left) nach unten rechts (bottom right) dargestellt */
    from-green-200 /* Farbverlauf startet mit hellem Grün */
    to-green-50    /* Farbverlauf endet mit sehr hellem Grün */
  "
>
  <!-- HEADER Bereich -->
  <header
    class="
      bg-black       /* Hintergrundfarbe schwarz */
      text-white     /* Textfarbe weiß */
      py-3           /* Vertikales Padding (oben & unten) = 0.75rem (12px) */
      px-6           /* Horizontales Padding (links & rechts) = 1.5rem (24px) */
      text-xl        /* Textgröße extra groß (ca. 1.25rem, 20px) */
      font-semibold  /* Schrift halb fett */
    "
  >
    Scrapetime <!-- Titel im Header -->
  </header>

  <!-- Hauptbereich mit Sidebar und Content nebeneinander -->
  <div
    class="
      flex         /* Flexbox: Kinder nebeneinander anordnen (Standard: row) */
      flex-grow    /* Container wächst, um verfügbaren Platz zu füllen */
      min-h-0      /* Wichtig für flexbox-scroll innerhalb des Containers (setzt min-height auf 0) */
    "
  >
    <!-- SIDEBAR: linke Leiste mit Einstellungen -->
    <aside
      class="
        w-72          /* Breite 18rem (288px) */
        bg-green-600  /* Hintergrund dunkelgrün */
        text-white    /* Textfarbe weiß */
        flex          /* Flexbox-Container für vertikale Anordnung */
        flex-col      /* Flex-Kinder werden untereinander (Spalte) angeordnet */
        p-6           /* Innenabstand rundherum 1.5rem (24px) */
        space-y-6     /* Vertikaler Abstand zwischen flex-Kindern 1.5rem (24px) */
      "
    >
      <h2
        class="
          text-2xl      /* Textgröße 1.5rem (24px), größer als normal */
          font-semibold /* Schrift halb fett */
          mb-4         /* Margin-Bottom: Abstand unter dem Element 1rem (16px) */
        "
      >
        Einstellungen
      </h2>

      <!-- Startdatum Input -->
      <div>
        <label
          for="start-date"
          class="
            block          /* Label als Blockelement (geht auf volle Breite) */
            mb-1           /* Margin-Bottom 0.25rem (4px) für Abstand zum Input */
            font-semibold  /* Fettgedruckt */
          "
        >
          Startdatum
        </label>
        <input
          type="date"
          id="start-date"
          class="
            w-full           /* Input füllt die komplette Breite des Containers */
            rounded-md       /* Mittlere Abrundung der Ecken */
            px-3             /* Horizontaler Innenabstand 0.75rem (12px) */
            py-2             /* Vertikaler Innenabstand 0.5rem (8px) */
            text-black       /* Textfarbe schwarz */
            focus:outline-none       /* Entfernt Standard-Fokusrahmen (blaue Umrandung) */
            focus:ring-2            /* Beim Fokussieren erscheint ein Ring mit 2px Breite */
            focus:ring-green-300    /* Farbe des Fokus-Rings: helles Grün */
          "
        />
      </div>

      <!-- Enddatum Input, gleich aufgebaut wie Startdatum -->
      <div>
        <label
          for="end-date"
          class="block mb-1 font-semibold"
        >
          Enddatum
        </label>
        <input
          type="date"
          id="end-date"
          class="w-full rounded-md px-3 py-2 text-black focus:outline-none focus:ring-2 focus:ring-green-300"
        />
      </div>

      <!-- Buttons vertikal anordnen -->
      <div
        class="
          flex         /* Flexbox */
          flex-col     /* Kinder untereinander */
          space-y-3    /* Abstand zwischen Buttons 0.75rem (12px) */
        "
      >
        <!-- Login-Button -->
        <button
          id="login-btn"
          class="
            bg-green-800       /* Dunkelgrüner Hintergrund */
            hover:bg-green-900 /* Hintergrund wird beim Hover noch dunkler */
            transition         /* Sanfter Übergang beim Hover (Farbwechsel) */
            rounded            /* Leicht abgerundete Ecken */
            py-2               /* Vertikales Padding 0.5rem (8px) */
            font-semibold      /* Fettgedruckter Text */
          "
        >
          Login &amp; Cookies speichern
        </button>

        <!-- Scraping starten Button -->
        <button
          id="scrape-btn"
          class="
            bg-green-500       /* Helleres Grün als Login Button */
            hover:bg-green-600 /* Etwas dunkler beim Hover */
            transition         /* Sanfter Übergang */
            rounded            /* Abgerundete Ecken */
            py-2               /* Vertikales Padding */
            font-semibold      /* Fett */
          "
        >
          Scraping starten
        </button>
      </div>
    </aside>

    <!-- MAIN Content Bereich rechts -->
    <main
      class="
        flex-grow           /* Nimmt den restlichen Platz ein */
        bg-white            /* Weißer Hintergrund */
        rounded-tl-3xl      /* Obere linke Ecke sehr stark abgerundet (3xl = ca. 1.5rem / 24px) */
        rounded-bl-3xl      /* Untere linke Ecke ebenfalls abgerundet */
        p-8                 /* Innenabstand rundherum 2rem (32px) */
        overflow-auto       /* Bei Überlauf Scrollbalken anzeigen */
      "
      style="min-width: 0;" <!-- Wichtig: erlaubt flex-Kindern das Schrumpfen -->
    >
      <!-- Überschrift -->
      <h1
        class="
          text-3xl       /* Sehr große Schrift (ca. 1.875rem, 30px) */
          font-bold      /* Sehr fett */
          mb-6          /* Margin unten 1.5rem (24px) */
          text-gray-800  /* Dunkelgraue Farbe für Text */
        "
      >
        Redezeit Analyse
      </h1>

      <!-- Log-Ausgabe Bereich -->
      <div
        id="log"
        class="
          bg-gray-100          /* Sehr hellgrauer Hintergrund */
          border border-gray-300 /* Rahmen mit mittlerem Grau */
          rounded              /* Abgerundete Ecken */
          p-4                  /* Innenabstand 1rem (16px) */
          font-mono            /* Monospace Schriftart für Logs */
          text-sm              /* Kleinere Schriftgröße */
          h-96                 /* Höhe 24rem (384px), damit Bereich immer gleich hoch ist */
          overflow-auto        /* Scrollbar falls Text länger als Box */
          whitespace-pre-wrap  /* Zeilenumbruch erhält Leerzeichen und Zeilenumbrüche */
          text-gray-700        /* Mittelgraue Textfarbe */
        "
      >
        <!-- Hier werden Log-Nachrichten via JavaScript reingeschrieben -->
      </div>
    </main>
  </div>

  <!-- FOOTER Bereich -->
  <footer
    class="
      bg-black        /* Schwarzer Hintergrund */
      text-white      /* Weißer Text */
      py-3            /* Vertikales Padding 0.75rem (12px) */
      px-6            /* Horizontales Padding 1.5rem (24px) */
      text-center     /* Text wird zentriert */
      text-sm         /* Kleinere Schriftgröße */
    "
  >
    &copy; 2025 Scrapetime - Alle Rechte vorbehalten
  </footer>

  <!-- JavaScript für Interaktivität -->
  <script>
    // Heutiges Datum im Format 'YYYY-MM-DD' holen
    const today = new Date().toISOString().split("T")[0];

    // Inputs mit Standardwerten füllen
    document.getElementById("start-date").value = today;
    document.getElementById("end-date").value = today;

    // Referenzen zu Buttons und Log-Container holen
    const loginBtn = document.getElementById("login-btn");
    const scrapeBtn = document.getElementById("scrape-btn");
    const logBox = document.getElementById("log");

    // Funktion um eine neue Zeile mit Zeitstempel in den Log zu schreiben
    function log(message) {
      const timestamp = new Date().toLocaleTimeString(); // z.B. "14:35:01"
      logBox.textContent += `[${timestamp}] ${message}\n`; // Text anhängen + Zeilenumbruch
      logBox.scrollTop = logBox.scrollHeight; // Scrollt Log ganz nach unten
    }

    // Klick-Event: Login Button
    loginBtn.addEventListener("click", async () => {
      log("Starte Login-Vorgang...");
      try {
        // Beispielhafter HTTP POST Request (Dummy, funktioniert nur mit Backend)
        const res = await fetch("/save-cookies", { method: "POST" });
        const data = await res.json();
        log(data.detail || "Login-Vorgang abgeschlossen.");
      } catch (error) {
        log("Fehler beim Login: " + error.message);
      }
    });

    // Klick-Event: Scraping starten Button
    scrapeBtn.addEventListener("click", async () => {
      const startDate = document.getElementById("start-date").value;
      const endDate = document.getElementById("end-date").value;

      // Einfachste Validierung
      if (!startDate || !endDate) {
        log("Bitte Start- und Enddatum wählen.");
        return;
      }

      log(`Starte Scraping von ${startDate} bis ${endDate}...`);

      try {
        // Beispiel Fetch an Backend, Daten werden als JSON gesendet
        const res = await fetch("/run-scraper", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ start_date: startDate, end_date: endDate }),
        });

        const result = await res.json();

        log("Scraping abgeschlossen.");

        // Ergebnisse durchlaufen und ausgeben
        result.results.forEach((entry) => {
          log(
            `${entry.date}: ${entry.status}${
              entry.message ? " - " + entry.message : ""
            }`
          );
        });
      } catch (error) {
        log("Fehler beim Scraping: " + error.message);
      }
    });
  </script>
</body>
</html>
